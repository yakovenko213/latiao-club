<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latiao Club | KeyCRM Luxury Integration</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@200;400;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap');

        :root {
            --gold: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --gold-static: #c5a059;
            --bg-deep: #0a0a0a;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(197, 160, 89, 0.2);
            --text-gold: #e2c275;
            --font-main: 'Montserrat', sans-serif;
            --font-title: 'Playfair Display', serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-main); }
        body { background-color: var(--bg-deep); color: #fff; min-height: 100vh; display: flex; overflow-x: hidden; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background: radial-gradient(circle at 50% -20%, #1a150e 0%, #0a0a0a 80%); }

        /* SIDEBAR */
        .sidebar { width: 280px; background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(20px); border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; padding: 40px 20px; z-index: 100; }
        .logo { font-family: var(--font-title); font-size: 26px; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-align: center; letter-spacing: 2px; margin-bottom: 50px; }
        .nav-item { padding: 15px 20px; color: #666; text-transform: uppercase; font-size: 11px; letter-spacing: 2px; cursor: pointer; transition: 0.3s; border-radius: 2px; margin-bottom: 5px; }
        .nav-item:hover, .nav-item.active { background: var(--glass); color: var(--text-gold); padding-left: 25px; }

        /* MAIN CONTENT */
        .main { flex: 1; padding: 50px; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.8s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .glass-card { background: var(--glass); border: 1px solid var(--glass-border); padding: 35px; border-radius: 2px; margin-bottom: 30px; }
        .gold-btn { background: var(--gold); color: #000; border: none; padding: 15px 25px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .gold-btn:hover { filter: brightness(1.2); box-shadow: 0 0 15px rgba(197, 160, 89, 0.3); }

        .input-luxe { background: transparent; border: none; border-bottom: 1px solid var(--glass-border); color: #fff; padding: 12px 0; width: 100%; font-size: 15px; outline: none; margin-bottom: 25px; }
        
        /* ORDERS TABLE */
        .order-row { display: grid; grid-template-columns: 1fr 1fr 1fr; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; }
        .status-pill { padding: 2px 8px; border-radius: 10px; font-size: 10px; text-transform: uppercase; background: var(--glass-border); color: var(--gold-static); }

        .hidden { display: none !important; }
        @media (max-width: 900px) { body { flex-direction: column; } .sidebar { width: 100%; border-right: none; border-bottom: 1px solid var(--glass-border); } }
    </style>
</head>
<body>

    <div class="bg-overlay"></div>

    <aside id="sidebar" class="sidebar hidden">
        <div class="logo">LATIAO CLUB</div>
        <nav style="flex: 1;">
            <div class="nav-item active" onclick="showScreen('home')">–ö–∞–±—ñ–Ω–µ—Ç</div>
            <div class="nav-item" onclick="showScreen('promo')">–ü—Ä–∏–≤—ñ–ª–µ—ó</div>
            <div class="nav-item" onclick="checkAdmin()">–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</div>
        </nav>
        <div class="nav-item" onclick="location.reload()" style="color: #833;">–í–∏–π—Ç–∏</div>
    </aside>

    <main class="main">
        <section id="screen-login" style="max-width: 400px; margin: 15vh auto;">
            <div class="glass-card" style="text-align: center;">
                <h1 class="logo">–í–•–Ü–î –£ –ö–õ–£–ë</h1>
                <input type="text" id="login-phone" class="input-luxe" placeholder="–í–í–ï–î–Ü–¢–¨ –ù–û–ú–ï–† –¢–ï–õ–ï–§–û–ù–£">
                <button class="gold-btn" style="width: 100%;" onclick="login()">–ê–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—å</button>
            </div>
        </section>

        <section id="screen-home" class="hidden">
            <h1 id="user-title" class="font-title" style="font-size: 36px; margin-bottom: 30px;">–í—ñ—Ç–∞—î–º–æ</h1>
            
            <div class="glass-card">
                <p style="font-size: 10px; color: var(--gold-static); letter-spacing: 2px; margin-bottom: 20px;">–í–ê–®–Ü –ó–ê–ú–û–í–õ–ï–ù–ù–Ø (KEYCRM)</p>
                <div id="orders-container">
                    <p style="color: #666; font-size: 12px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>
                </div>
            </div>
        </section>

        <section id="screen-admin" class="hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 class="font-title">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –°–∏—Å—Ç–µ–º–∏</h2>
                <button class="gold-btn" onclick="showScreen('home')">–ù–∞–∑–∞–¥</button>
            </div>

            <div class="glass-card">
                <p style="font-size: 10px; color: var(--gold-static); margin-bottom: 15px;">–Ü–ù–¢–ï–ì–†–ê–¶–Ü–Ø KEYCRM</p>
                <input type="password" id="keycrm-api-input" class="input-luxe" placeholder="–í–°–¢–ê–í–¢–ï –í–ê–® API KEY">
                <button class="gold-btn" onclick="saveApiKey()">–ó–±–µ—Ä–µ–≥—Ç–∏ –ö–ª—é—á</button>
                <p id="api-status" style="margin-top: 10px; font-size: 11px;"></p>
            </div>

            <div class="glass-card">
                <p style="font-size: 10px; color: var(--gold-static);">–õ–û–ì –ö–û–†–ò–°–¢–£–í–ê–ß–Ü–í</p>
                <div id="admin-user-list" style="margin-top: 20px;"></div>
            </div>
        </section>
    </main>

<script>
    const DB_KEY = 'latiao_keycrm_db';
    let db = JSON.parse(localStorage.getItem(DB_KEY)) || {
        apiKey: '',
        users: []
    };

    let currentUser = null;

    function save() { localStorage.setItem(DB_KEY, JSON.stringify(db)); }

    function showScreen(id) {
        document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
        document.getElementById(`screen-${id}`).classList.remove('hidden');
        if(id === 'home') fetchOrders();
        if(id === 'admin') renderAdmin();
    }

    function login() {
        const phone = document.getElementById('login-phone').value.trim();
        if(!phone) return alert('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω');
        
        let user = db.users.find(u => u.phone === phone);
        if(!user) {
            user = { phone, name: '–ì—ñ—Å—Ç—å –ö–ª—É–±—É', joined: new Date().toLocaleDateString() };
            db.users.push(user);
            save();
        }
        currentUser = user;
        document.getElementById('screen-login').classList.add('hidden');
        document.getElementById('sidebar').classList.remove('hidden');
        showScreen('home');
    }

    // --- KEYCRM INTEGRATION ---
    async function fetchOrders() {
        const container = document.getElementById('orders-container');
        document.getElementById('user-title').innerText = `–í—ñ—Ç–∞—î–º–æ, ${currentUser.phone}`;

        if(!db.apiKey) {
            container.innerHTML = `<p style="color:#833;">–ö–ª—é—á API –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –≤ –∞–¥–º—ñ–Ω—Ü—ñ.</p>`;
            return;
        }

        try {
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ CORS Proxy –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ (–æ—Å–∫—ñ–ª—å–∫–∏ KeyCRM –Ω–µ –ø—É—Å—Ç–∏—Ç—å –∑–∞–ø–∏—Ç –ø—Ä—è–º–æ –∑ –±—Ä–∞—É–∑–µ—Ä–∞ —á–µ—Ä–µ–∑ CORS)
            const proxy = "https://api.allorigins.win/raw?url=";
            const targetUrl = `https://openapi.keycrm.app/v1/order?filter[contact_phone]=${currentUser.phone}`;
            
            const response = await fetch(proxy + encodeURIComponent(targetUrl), {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${db.apiKey}`,
                    'Accept': 'application/json'
                }
            });

            const data = await response.json();
            
            if(data.data && data.data.length > 0) {
                let html = `
                    <div class="order-row" style="color: var(--gold-static); border-bottom: 2px solid var(--glass-border);">
                        <span>–ù–û–ú–ï–†</span><span>–°–£–ú–ê</span><span>–°–¢–ê–¢–£–°</span>
                    </div>`;
                data.data.forEach(order => {
                    html += `
                        <div class="order-row">
                            <span>#${order.id}</span>
                            <span>${order.grand_total} ${order.currency_code}</span>
                            <span><span class="status-pill">${order.status_id}</span></span>
                        </div>`;
                });
                container.innerHTML = html;
            } else {
                container.innerHTML = `<p style="color:#666;">–ó–∞–º–æ–≤–ª–µ–Ω—å –∑–∞ —Ü–∏–º –Ω–æ–º–µ—Ä–æ–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>`;
            }
        } catch (e) {
            container.innerHTML = `<p style="color:#833;">–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É –¥–æ KeyCRM. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API –∫–ª—é—á.</p>`;
        }
    }

    // --- ADMIN LOGIC ---
    function checkAdmin() {
        if(prompt('–í–í–ï–î–Ü–¢–¨ –ü–ê–†–û–õ–¨:') === 'latiao2026') showScreen('admin');
    }

    function saveApiKey() {
        const key = document.getElementById('keycrm-api-input').value.trim();
        if(key) {
            db.apiKey = key;
            save();
            document.getElementById('api-status').innerText = '–ö–ª—é—á –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!';
            document.getElementById('api-status').style.color = '#4a4';
        }
    }

    function renderAdmin() {
        document.getElementById('keycrm-api-input').value = db.apiKey;
        const list = document.getElementById('admin-user-list');
        list.innerHTML = db.users.map(u => `
            <div style="font-size:12px; margin-bottom:10px; border-bottom:1px solid #222; padding-bottom:5px;">
                üìû ${u.phone} | –ü—Ä–∏—î–¥–Ω–∞–≤—Å—è: ${u.joined}
            </div>
        `).join('');
    }
</script>
</body>
</html>
